{% load static %}
<link href="{% static 'css/carousel.css' %}" rel='stylesheet' type='text/css'>

<div class="carousel-container">
  <!-- Carousel Indicators -->
  <div id="homeCarousel" class="carousel slide carousel-fade" data-bs-ride="carousel">
    <div class="carousel-indicators">
      {% for image in carousel_images %}
        <button type="button" data-bs-target="#homeCarousel" data-bs-slide-to="{{ forloop.counter0 }}" {% if forloop.first %}class="active" aria-current="true"{% endif %} aria-label="Slide {{ forloop.counter }}"></button>
      {% empty %}
        <!-- Default indicators if no images in database -->
        <button type="button" data-bs-target="#homeCarousel" data-bs-slide-to="0" class="active" aria-current="true" aria-label="Slide 1"></button>
        <button type="button" data-bs-target="#homeCarousel" data-bs-slide-to="1" aria-label="Slide 2"></button>
        <button type="button" data-bs-target="#homeCarousel" data-bs-slide-to="2" aria-label="Slide 3"></button>
      {% endfor %}
    </div>
    
    <!-- Carousel Items -->
    <div class="carousel-inner">
      {% for image in carousel_images %}
        <div class="carousel-item {% if forloop.first %}active{% endif %}">
          <div class="carousel-image-container">
            {% if image.get_image_url %}
              <img src="{{ image.get_image_url }}" class="carousel-image" alt="{{ image.title }}">
            {% else %}
              <img src="{% static 'images/placeholder.jpg' %}" class="carousel-image" alt="Placeholder">
            {% endif %}
          </div>
          <div class="carousel-caption">
            <h2>{{ image.title }}</h2>
            <p>{{ image.subtitle }}</p>
            {% if image.button_text and image.button_link %}
              <a href="{{ image.button_link }}" class="btn carousel-btn">{{ image.button_text }}</a>
            {% endif %}
          </div>
        </div>
      {% empty %}
        <!-- Default carousel items if no images in database -->
        <div class="carousel-item active">
          <div class="carousel-image-container">
            <img src="{% static 'image/carousel1.jpg' %}" class="carousel-image" alt="School Campus">
          </div>
          <div class="carousel-caption">
            <h2>Welcome to Kapadia High School</h2>
            <p>Nurturing Excellence Since 1956</p>
            <a href="{% url 'aboutSchool' %}" class="btn carousel-btn">Learn More</a>
          </div>
        </div>
        <div class="carousel-item">
          <div class="carousel-image-container">
            <img src="{% static 'image/carousel2.jpg' %}" class="carousel-image" alt="Students">
          </div>
          <div class="carousel-caption">
            <h2>Excellence in Education</h2>
            <p>Developing Future Leaders</p>
            <a href="#" class="btn carousel-btn">Our Programs</a>
          </div>
        </div>
        <div class="carousel-item">
          <div class="carousel-image-container">
            <img src="{% static 'image/carousel3.jpg' %}" class="carousel-image" alt="School Activities">
          </div>
          <div class="carousel-caption">
            <h2>Holistic Development</h2>
            <p>Academic Excellence and Beyond</p>
            <a href="{% url 'gallery' %}" class="btn carousel-btn">View Gallery</a>
          </div>
        </div>
      {% endfor %}
    </div>
    
    <!-- Standard Bootstrap Carousel Controls -->
    <a class="carousel-control-prev" href="#homeCarousel" role="button" data-bs-slide="prev">
      <span class="carousel-control-prev-icon" aria-hidden="true"></span>
      <span class="visually-hidden">Previous</span>
    </a>
    <a class="carousel-control-next" href="#homeCarousel" role="button" data-bs-slide="next">
      <span class="carousel-control-next-icon" aria-hidden="true"></span>
      <span class="visually-hidden">Next</span>
    </a>
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    // Initialize carousel with proper options
    var carousel = document.querySelector('#homeCarousel');
    var carouselInstance = new bootstrap.Carousel(carousel, {
      interval: 5000,  // Auto-slide every 5 seconds
      wrap: true,       // Loop back to first slide
      keyboard: true    // Allow keyboard navigation
    });
    
    // Fix for Supabase images
    var carouselImages = document.querySelectorAll('.carousel-image');
    carouselImages.forEach(function(img) {
      // Check if image is from Supabase
      if (img.src.includes('supabase.co')) {
        img.onload = function() {
          // Ensure image is properly positioned
          this.style.position = 'absolute';
          this.style.top = '50%';
          this.style.left = '50%';
          this.style.transform = 'translate(-50%, -50%)';
          this.style.minWidth = '100%';
          this.style.minHeight = '100%';
          this.style.width = 'auto';
          this.style.height = 'auto';
          this.style.objectFit = 'cover';
        };
      }
    });
  });
</script>
